# ğŸ¯ COMPLETE ID-BASED HRMS WORKFLOW SYSTEM

## ğŸ“‹ **PROFESSIONAL RECRUITMENT-TO-PAYROLL WORKFLOW**

This document provides a complete guide to the ID-based workflow system that powers the entire HRMS recruitment lifecycle.

---

## ğŸ”„ **WORKFLOW OVERVIEW**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    COMPLETE RECRUITMENT WORKFLOW                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    JOB POSTING          APPLICATION         INTERVIEW          OFFER           EMPLOYEE
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ JOB-    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚  APP-    â”‚â”€â”€â”€â”€â”€â”€â–¶â”‚  INT-   â”‚â”€â”€â”€â”€â”€â”€â–¶â”‚ OFF- â”‚â”€â”€â”€â”€â”€â”€â”€â–¶â”‚  EMP-   â”‚
    â”‚ 2026-   â”‚         â”‚  2026-   â”‚       â”‚  2026-  â”‚       â”‚ 2026-â”‚        â”‚  HR-    â”‚
    â”‚ 0001    â”‚         â”‚  0001    â”‚       â”‚  0001   â”‚       â”‚ 0001 â”‚        â”‚  0001   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                    â”‚                   â”‚               â”‚                â”‚
         â”‚                    â”‚                   â”‚               â”‚                â”‚
    [OPEN/CLOSED]      [STATUS MACHINE]    [ROUNDS 1-N]    [SENT/ACCEPTED]   [ACTIVE]
         â”‚                    â”‚                   â”‚               â”‚                â”‚
         â”‚                    â–¼                   â”‚               â”‚                â–¼
         â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚               â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚            â”‚ APPLIED       â”‚           â”‚               â”‚         â”‚ PAYROLL  â”‚
         â”‚            â”‚ SHORTLISTED   â”‚           â”‚               â”‚         â”‚ PAY-     â”‚
         â”‚            â”‚ INTERVIEW     â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚         â”‚ 202601-  â”‚
         â”‚            â”‚ SELECTED      â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚ 0001     â”‚
         â”‚            â”‚ OFFERED       â”‚                                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚            â”‚ JOINED        â”‚
         â”‚            â”‚ REJECTED      â”‚
         â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
    â”‚CANDIDATEâ”‚
    â”‚ CAN-    â”‚
    â”‚ 2026-   â”‚
    â”‚ 0001    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ†” **ID GENERATION SYSTEM**

### **ID Formats**

| Entity | Format | Example | Description |
|--------|--------|---------|-------------|
| **Job** | `JOB-YYYY-XXXX` | `JOB-2026-0001` | Job posting/requirement |
| **Candidate** | `CAN-YYYY-XXXX` | `CAN-2026-0042` | Registered candidate |
| **Application** | `APP-YYYY-XXXX` | `APP-2026-0123` | Job application |
| **Interview** | `INT-YYYY-XXXX` | `INT-2026-0089` | Interview round |
| **Offer** | `OFF-YYYY-XXXX` | `OFF-2026-0015` | Offer letter |
| **Employee** | `EMP-DEPT-XXXX` | `EMP-HR-0001` | Employee (dept-specific) |
| **Payslip** | `PAY-YYYYMM-XXXX` | `PAY-202601-0001` | Monthly payslip |

### **Key Features**

âœ… **Atomic Counter Increments** - Thread-safe, no duplicates  
âœ… **Year-Based Reset** - Counters reset each year automatically  
âœ… **Department-Specific** - Employee IDs include department code  
âœ… **Immutable** - IDs cannot be changed once generated  
âœ… **Human-Readable** - Easy to communicate and reference  

---

## ğŸ“Š **STATUS FLOW DIAGRAMS**

### **Application Status Machine**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    APPLICATION STATUS TRANSITIONS                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚ APPLIED  â”‚ â—€â”€â”€ Initial State
                            â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                                 â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚            â”‚            â”‚
                    â–¼            â–¼            â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚SHORTLISTEDâ”‚  â”‚ REJECTED â”‚  â”‚ ON_HOLD  â”‚
            â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                 â”‚                            â”‚
                 â–¼                            â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
            â”‚INTERVIEW â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ SELECTED â”‚
            â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ OFFERED  â”‚
            â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  JOINED  â”‚ â—€â”€â”€ Terminal State
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    Terminal States: JOINED, REJECTED, WITHDRAWN
```

### **Offer Status Machine**

```
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ DRAFT â”‚â”€â”€â”€â”€â”€â–¶â”‚ SENT â”‚â”€â”€â”€â”€â”€â–¶â”‚ ACCEPTED â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”¬â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”‚           â”‚ REJECTED â”‚
                      â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                  â”‚ EXPIRED  â”‚
                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”’ **BUSINESS RULES ENFORCEMENT**

### **1. Job Application Rules**

```javascript
âœ… ALLOWED:
- Job must be OPEN
- Candidate can apply once per job
- All required info must be provided

âŒ BLOCKED:
- Applying to CLOSED jobs â†’ Error: "JOB_NOT_OPEN"
- Duplicate applications â†’ Error: "DUPLICATE_APPLICATION"
- Missing candidate info â†’ Error: "VALIDATION_ERROR"
```

### **2. Interview Scheduling Rules**

```javascript
âœ… ALLOWED:
- Application status: SHORTLISTED or INTERVIEW
- Multiple rounds per application
- Interview details complete

âŒ BLOCKED:
- Status is APPLIED â†’ Error: "INVALID_STATUS_FOR_INTERVIEW"
- Incomplete interview details â†’ Error: "VALIDATION_ERROR"
```

### **3. Offer Creation Rules**

```javascript
âœ… ALLOWED:
- Application status: SELECTED
- No existing offer for application
- Salary structure defined
- Valid joining date

âŒ BLOCKED:
- Status not SELECTED â†’ Error: "CANNOT_CREATE_OFFER"
- Offer already exists â†’ Error: "DUPLICATE_OFFER"
- Invalid salary structure â†’ Error: "SALARY_STRUCTURE_NOT_FOUND"
```

### **4. Employee Conversion Rules**

```javascript
âœ… ALLOWED:
- Offer status: ACCEPTED
- No existing employee for offer
- All employee details complete

âŒ BLOCKED:
- Offer not accepted â†’ Error: "CANNOT_CREATE_EMPLOYEE"
- Employee already exists â†’ Error: "DUPLICATE_EMPLOYEE"
- Missing required fields â†’ Error: "VALIDATION_ERROR"
```

---

## ğŸ¯ **API USAGE EXAMPLES**

### **1. Create Application**

```javascript
POST /api/recruitment/applications

{
  "jobId": "65abc123...",
  "candidateId": "65def456...",
  "candidateInfo": {
    "name": "John Doe",
    "email": "john@example.com",
    "mobile": "+1234567890",
    "experience": "5 years",
    "currentCTC": "800000",
    "expectedCTC": "1200000",
    "resume": "/uploads/resumes/john-resume.pdf"
  },
  "source": "CAREER_PORTAL",
  "priority": "HIGH"
}

RESPONSE:
{
  "success": true,
  "message": "Application submitted successfully",
  "data": {
    "applicationId": "APP-2026-0001",
    "_id": "65xyz789...",
    "status": "APPLIED",
    "jobTitle": "Senior Developer",
    "appliedDate": "2026-01-16T08:00:00.000Z"
  }
}
```

### **2. Update Application Status**

```javascript
PATCH /api/recruitment/applications/65xyz789.../status

{
  "status": "SHORTLISTED",
  "reason": "Strong technical background and relevant experience"
}

RESPONSE:
{
  "success": true,
  "message": "Application status updated to SHORTLISTED",
  "data": {
    "applicationId": "APP-2026-0001",
    "status": "SHORTLISTED",
    "previousStatus": "APPLIED"
  }
}
```

### **3. Schedule Interview**

```javascript
POST /api/recruitment/applications/65xyz789.../interviews

{
  "date": "2026-01-20",
  "time": "10:00 AM",
  "mode": "Online",
  "location": "https://meet.google.com/abc-defg-hij",
  "interviewerName": "Jane Smith",
  "interviewerId": "65interviewer123...",
  "notes": "Technical round - focus on React and Node.js"
}

RESPONSE:
{
  "success": true,
  "message": "Interview scheduled successfully",
  "data": {
    "interviewId": "INT-2026-0001",
    "round": 1,
    "date": "2026-01-20",
    "time": "10:00 AM",
    "applicationStatus": "INTERVIEW"
  }
}
```

### **4. Create Offer**

```javascript
POST /api/recruitment/applications/65xyz789.../offer

{
  "salaryStructureId": "65salary123...",
  "department": "Engineering",
  "designation": "Senior Developer",
  "location": "Bangalore",
  "reportingTo": "Tech Lead",
  "joiningDate": "2026-02-01",
  "probationPeriod": 3,
  "noticePeriod": 30,
  "validUntil": "2026-01-25",
  "benefits": [
    { "name": "Health Insurance", "description": "Family coverage" },
    { "name": "Flexible Hours", "description": "Work from home 2 days/week" }
  ]
}

RESPONSE:
{
  "success": true,
  "message": "Offer created successfully",
  "data": {
    "offerId": "OFF-2026-0001",
    "_id": "65offer123...",
    "status": "DRAFT",
    "validUntil": "2026-01-25",
    "ctc": 1200000
  }
}
```

### **5. Convert to Employee**

```javascript
POST /api/recruitment/offers/65offer123.../convert-to-employee

{
  "actualJoiningDate": "2026-02-01",
  "department": "HR"
}

RESPONSE:
{
  "success": true,
  "message": "Employee created successfully",
  "data": {
    "employeeId": "EMP-HR-0001",
    "_id": "65emp123...",
    "name": "John Doe",
    "email": "john@example.com",
    "department": "Engineering",
    "designation": "Senior Developer",
    "joiningDate": "2026-02-01"
  }
}
```

---

## âš ï¸ **EDGE CASES & HANDLING**

### **1. Offer Accepted but Candidate No-Show**

**Scenario:** Candidate accepts offer but doesn't join on the scheduled date.

**Solution:**
```javascript
// Option 1: Mark as withdrawn
PATCH /api/recruitment/applications/{id}/status
{ "status": "WITHDRAWN", "reason": "Candidate no-show" }

// Option 2: Keep offer in ACCEPTED state and follow up
// Don't create employee until actual joining confirmed
```

### **2. Multiple Offers Blocked**

**Scenario:** HR tries to create second offer for same application.

**Prevention:**
```javascript
// System automatically blocks with error
{
  "success": false,
  "message": "Cannot create offer. Existing offer: true",
  "code": "CANNOT_CREATE_OFFER"
}
```

### **3. Job Reopened After Close**

**Scenario:** Job was closed, now needs to be reopened.

**Solution:**
```javascript
// Update job status
PATCH /api/requirements/{jobId}
{ "status": "Open" }

// Existing applications remain in their current state
// New applications can be accepted
```

### **4. Candidate Applies Again After Rejection**

**Scenario:** Candidate was rejected, wants to apply again.

**Solution:**
```javascript
// Option 1: Create new application (allowed by system)
// Previous application remains with REJECTED status

// Option 2: Reopen previous application (manual HR action)
PATCH /api/recruitment/applications/{id}/status
{ "status": "APPLIED", "reason": "Reconsidering candidate" }
```

### **5. Year Change Counter Reset**

**Scenario:** New year begins, counters should reset.

**Automatic Handling:**
```javascript
// System automatically uses year in counter key
// JOB_2025 â†’ JOB_2026
// Counters start from 0001 for new year
// Previous year IDs remain unchanged
```

### **6. Offer Expiry**

**Scenario:** Offer validity period expires.

**Automatic Handling:**
```javascript
// Pre-save middleware checks expiry
if (validUntil < new Date() && status === 'SENT') {
  this.isExpired = true;
  this.status = 'EXPIRED';
}

// Cron job to mark expired offers
Offer.markExpiredOffers(tenantId);
```

---

## ğŸš€ **INTEGRATION GUIDE**

### **Step 1: Add Routes to Express App**

```javascript
// backend/app.js or server.js
const recruitmentWorkflowRoutes = require('./routes/recruitment.workflow.routes');

app.use('/api/recruitment', recruitmentWorkflowRoutes);
```

### **Step 2: Update Existing Models**

```javascript
// Add readable IDs to existing models

// Requirement.js (Job)
jobOpeningId: { type: String, unique: true, index: true }

// Candidate.js
candidateId: { type: String, unique: true, index: true }

// Employee.js
employeeId: { type: String, unique: true, index: true }
```

### **Step 3: Generate IDs on Creation**

```javascript
// Example: Creating a job
const { generateJobId } = require('./utils/idGenerator');

const jobOpeningId = await generateJobId(db);
const job = new Requirement({
  jobOpeningId,
  jobTitle: 'Senior Developer',
  // ... other fields
});
```

---

## ğŸ“± **FRONTEND IMPLEMENTATION**

### **React Component Structure**

```
src/
â”œâ”€â”€ pages/
â”‚   â”œâ”€â”€ Recruitment/
â”‚   â”‚   â”œâ”€â”€ JobList.jsx              # List all jobs
â”‚   â”‚   â”œâ”€â”€ ApplicationPipeline.jsx  # Kanban board by status
â”‚   â”‚   â”œâ”€â”€ ApplicationDetail.jsx    # Single application view
â”‚   â”‚   â”œâ”€â”€ InterviewScheduler.jsx   # Schedule interviews
â”‚   â”‚   â”œâ”€â”€ OfferCreation.jsx        # Create offer modal
â”‚   â”‚   â””â”€â”€ OfferAcceptance.jsx      # Candidate acceptance page
â”‚   â””â”€â”€ Employee/
â”‚       â””â”€â”€ EmployeeOnboarding.jsx   # Post-conversion onboarding
â””â”€â”€ components/
    â”œâ”€â”€ StatusBadge.jsx              # Color-coded status badges
    â”œâ”€â”€ WorkflowTimeline.jsx         # Visual timeline of application
    â””â”€â”€ ActionButtons.jsx            # Context-aware action buttons
```

### **Status-Based UI Logic**

```javascript
// ApplicationDetail.jsx
const ApplicationDetail = ({ application }) => {
  const canScheduleInterview = ['SHORTLISTED', 'INTERVIEW'].includes(application.status);
  const canCreateOffer = application.status === 'SELECTED' && !application.offerId;
  const canConvertToEmployee = application.offerStatus === 'ACCEPTED' && !application.employeeId;
  
  return (
    <div>
      {/* Show interview button only if allowed */}
      {canScheduleInterview && (
        <button onClick={handleScheduleInterview}>
          Schedule Interview
        </button>
      )}
      
      {/* Show offer button only if allowed */}
      {canCreateOffer && (
        <button onClick={handleCreateOffer}>
          Create Offer
        </button>
      )}
      
      {/* Show employee conversion only if allowed */}
      {canConvertToEmployee && (
        <button onClick={handleConvertToEmployee}>
          Create Employee Account
        </button>
      )}
    </div>
  );
};
```

### **Kanban Pipeline View**

```javascript
// ApplicationPipeline.jsx
const ApplicationPipeline = ({ jobId }) => {
  const [pipeline, setPipeline] = useState({});
  
  useEffect(() => {
    fetchPipeline();
  }, [jobId]);
  
  const fetchPipeline = async () => {
    const res = await api.get(`/recruitment/pipeline?jobId=${jobId}`);
    setPipeline(res.data.data.pipeline);
  };
  
  return (
    <div className="kanban-board">
      {['APPLIED', 'SHORTLISTED', 'INTERVIEW', 'SELECTED', 'OFFERED', 'JOINED'].map(status => (
        <div key={status} className="kanban-column">
          <h3>{status} ({pipeline[status]?.count || 0})</h3>
          {pipeline[status]?.applications.map(app => (
            <ApplicationCard key={app.id} application={app} />
          ))}
        </div>
      ))}
    </div>
  );
};
```

---

## âœ… **BEST PRACTICES**

### **1. Always Use Transactions**

```javascript
// For multi-step operations
const session = await mongoose.startSession();
session.startTransaction();

try {
  // Step 1: Create offer
  await offer.save({ session });
  
  // Step 2: Update application
  await application.save({ session });
  
  await session.commitTransaction();
} catch (error) {
  await session.abortTransaction();
  throw error;
} finally {
  session.endSession();
}
```

### **2. Validate Before State Changes**

```javascript
// Use model methods for validation
try {
  application.changeStatus('SELECTED', userId, userName);
  await application.save();
} catch (error) {
  // Error contains detailed validation message
  return res.status(400).json({ message: error.message });
}
```

### **3. Maintain Audit Trails**

```javascript
// Every status change is logged
application.statusHistory.push({
  from: 'INTERVIEW',
  to: 'SELECTED',
  changedBy: 'HR Manager',
  changedById: userId,
  reason: 'Passed all interview rounds',
  timestamp: new Date()
});
```

### **4. Use Virtual Fields for Logic**

```javascript
// Instead of checking conditions everywhere
if (application.canCreateOffer) {
  // Create offer
}

// Virtual field handles the logic
ApplicationSchema.virtual('canCreateOffer').get(function() {
  return this.status === 'SELECTED' && !this.offerId;
});
```

---

## âŒ **COMMON MISTAKES TO AVOID**

### **1. âŒ Skipping Status Validation**

```javascript
// WRONG: Direct status update
application.status = 'OFFERED';
await application.save();

// RIGHT: Use validation method
application.changeStatus('OFFERED', userId, userName);
await application.save();
```

### **2. âŒ Creating Employee Without Offer**

```javascript
// WRONG: Direct employee creation
const employee = new Employee({ ... });

// RIGHT: Use workflow controller
POST /api/recruitment/offers/{id}/convert-to-employee
```

### **3. âŒ Allowing Multiple Offers**

```javascript
// WRONG: Not checking existing offer
const offer = new Offer({ applicationId });

// RIGHT: Check before creation
if (await Offer.existsForApplication(tenantId, applicationId)) {
  throw new Error('Offer already exists');
}
```

### **4. âŒ Hardcoding IDs**

```javascript
// WRONG: Manual ID assignment
employee.employeeId = 'EMP-001';

// RIGHT: Use ID generator
const employeeId = await generateEmployeeId(db, department);
employee.employeeId = employeeId;
```

---

## ğŸ“ˆ **PERFORMANCE OPTIMIZATION**

### **Database Indexes**

```javascript
// Application indexes
ApplicationSchema.index({ tenant: 1, status: 1, createdAt: -1 });
ApplicationSchema.index({ tenant: 1, jobId: 1, candidateId: 1 }, { unique: true });

// Offer indexes
OfferSchema.index({ tenant: 1, status: 1, validUntil: 1 });
OfferSchema.index({ tenant: 1, applicationId: 1 }, { unique: true });
```

### **Caching Strategy**

```javascript
// Cache pipeline stats (Redis)
const cacheKey = `pipeline:${tenantId}:${jobId}`;
let pipeline = await redis.get(cacheKey);

if (!pipeline) {
  pipeline = await Application.getPipelineStats(tenantId, jobId);
  await redis.setex(cacheKey, 300, JSON.stringify(pipeline)); // 5 min cache
}
```

---

## ğŸ” **SECURITY CONSIDERATIONS**

1. **Role-Based Access Control**
   - Only HR can change application status
   - Only candidates can accept their own offers
   - Admins can override all actions

2. **Data Validation**
   - Validate all inputs before processing
   - Sanitize user-provided data
   - Check tenant isolation

3. **Audit Logging**
   - Log all status changes
   - Track who made changes and when
   - Store reasons for rejections

---

## ğŸ“ **SUPPORT & TROUBLESHOOTING**

### **Common Issues**

**Issue:** "Invalid status transition" error  
**Solution:** Check the status flow diagram. Some transitions are not allowed.

**Issue:** "Duplicate application" error  
**Solution:** Candidate has already applied to this job. Check existing applications.

**Issue:** "Cannot create employee" error  
**Solution:** Ensure offer is ACCEPTED and no employee exists for this offer.

---

## ğŸ“ **SUMMARY**

This ID-based workflow system provides:

âœ… **Professional ID Generation** - Human-readable, unique IDs for all entities  
âœ… **Strict Business Rules** - Enforced at model and controller level  
âœ… **Complete Audit Trail** - Every action is logged and traceable  
âœ… **Status Validation** - Invalid transitions are automatically blocked  
âœ… **Scalable Architecture** - Ready for production use  
âœ… **Zoho/Darwinbox Level** - Enterprise-grade workflow management  

---

**Version:** 2.0  
**Last Updated:** 2026-01-16  
**Author:** HRMS Architect Team
